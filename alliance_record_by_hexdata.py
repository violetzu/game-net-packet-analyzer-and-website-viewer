hex_data='3e070000001f8b08000000000004007d567d6c13e719bf703e43205b0b5dcbb66a52dab7135b57549fef1c9faf95d6c228a581c0125844b5891962821bc7a6b1439b5669134c923334764cbecd05a7c10969022114c817096ed5b5eb5681da6d5545d78ab1f8beb2ee1f56d14d5aa73d6ffc71d729ec74a7bbf7d1ef7deef73ecff37bdeb76f1541dc4f1044d9c6adbe4af7be3d9b5d815d5eb7cfbbcdb5778b77bf6f83735fd568731e910f101e9eecf70a7868a4b485948ba3b3f0fde885fbcc2fd71244fb5a82c883f123b5a645cc5df0d81c489a3d9f9a6a55861ab553e1f7c17420f6cb0758789fccc04b6f93c472787f0b1ed686582932a97437c942f21218befece83f91f707939df5b7f4e2dbeb16f3b87d4c341e5c8847a6952ee3c1303d3e3f3f75198aa9881739fe72dbe57612a283533939a3e26097d6fc070a1bcd4ec04d6b10cf45c95ee99a391d6745c6b4a4a62b374b66d144cbbdbbfb70213c97acea70d446c486a3d9a9a1a5107934abbd80ea6d0d341f2172504713c03f71d34e5e0360ec9ddfd9ad8202562ca89b6413039af3f465501bc27037fe6fb69ef38dc7606396b9c7e57e034ce8137601e5aadd348ce2fcbf9b55a90dc139784cb5242944fbcf93a985e2cd948b5bfa32f727a1f99f36b75a032a7dbe3ab1982c13f3e19a3ee3604cef7fb345f9c94a222b4d3595d5df7b46fef5e7f140cb797ef2737113a5b296aca45b9c88a3679dd15c52e6fe0380c0f7fed253fde939783e69369e81a9c6c3b928e5dc17744484d0dc03d02d69b9d65661cb92c939ff5a529af8687b1a162778def50a9eba0af26e0f65662eaa92753d4c3ebf409cffc26fd8b95988d0ded745554d495eec6857aed5fbf2bc0d1e8cd203fa2a89c6b3b8de48146694a90867bb6eeda5eb219275d7be2c1e5970cd1fed15f489d3d836a6a9da9d91e6da8573d1c529b925360ddb07a2eff5d2893becc0c65243da300b3b723a5f78ad426c8ad0338396b76e699a340a735839d3da5279d2b42524b7f6aae330283ba0d148969648318bd4de592435b68a426df50871b525313fdd878e30baa51d4c351f8415a0258910c92062372f3042eb997b4bf53b892ba32b8e69f182ad482d4e06ba9e4eb4aec883233d00d26e1669e09a7a523030f6c22f5c2b32139d62d774c2b42b3126e4980e98cf32d33bc7270e6613d8b563b7acae90d38fd7540b9d8edf79f00e3bfc52ed3e8823e41b845e66a0a422d758ec07dd03980877ffcca548c2964a0e4462a1763bb1dc9fd51a949503ae213b87fdcba9a5f06c511cf60cd33a61cb688459b3c7ee7369fdfe57f0bc65f7ddabf1c6b005f1873ed9a2e718705293349b9e174eaf229b9733c0ca6205f4062c6d9ac0caf4b4bf1db188e94f0113538073191a27338d9c4cdab267fadde10563e6b50b803797c875c756eec76e5fc0fc98421d91ed2d0682c689b331038e07aa1dced71d561d2affcadbea06b416fbe2faf3104c3020a7fd1e72df779f6f7c078fe5dced424ea312e7e4817a30d3a7a6c4c094dcbfdb35acb6bead133b8481e5befa082a2bec655557ad6190bd2e213526b581647a4c4185e24555e42e1269985bf23e9ed8665a149762b9dbdb88d5d5813301b85a57eaccb84b5824ce6b4e9843c3986f55db8304d0d2ee869d977d2c0c186d4b66135f2a67cf184dc75ae174c9f277e6c0a00e568c6f52b82ae59c68aa4b9f3d0d1d524f4c971257c0c2ff2d73b7c140e4b5609e227ba62a0b20786a4c8c438ae8f2f379acbd7e9c1b87bc7b29c671a3c0ba35a43b72c449533d1d44cf36fc15aebe1f2f18c6c72fe13257325c230a8da59b7d7a5f5364b276327c1f2837e0b859b56cbdaf462efc15ab158d9f5b475bdc55a6861782bc3b38e0fff64f8ad03c9629f7cae431a1414312ef79dc7e2abffee91c58885efe0c8c2db8a789a2ebf41e9054ba32dd59b7d15556e8fc755d30a967ffef453f20122dd9d9676c2da789beda9f837b2218d09ead949ad25aa2486b0ac9f176e925b88746c97f6c258792bb73d6e48126cd4d37dda9556ed6c877ca153eb3d851ddd78f6cf24fb7f1d59614d0c57fa8d9cc8b18bea4493341e51dbfad47008072756394209e21d1cd18510622bcd5b1d95f97a3b6439042718f5625c6b6c514f37e29a59f1d255eabd3de9025ec20bede0598ea7d9e76a97e5ea9a66d17c30311f1c9e0f8ee342dd5e5f6e2a5e97de9b9772c1f10ccd5bec7905862d9b416a7854090ee1b3cefbea6ed32131dd06979a6f8755f02cf35e81a1d1d0488a9c533a23f800545f2150b8736435f8f8af0c1d9d43da802835ccca6248696bc62bde36bf6a117efc0ebf2be22d34cf389e0f9972e229a2d10bf8ea876f527cceec2cd1557cfd3a95ebef507cbba4aecba0fa5d18fab6cc2d1e5ab2d7fffe8981dae569eed57afde803a9de5e7308d76ef9813a5760124c6bfff0198567df2143161b0e2fcd7e4619da2b0d796e90c54ba9d9a37056c45c1e0ddd4b19cf71719b219ad01c8ef6c0ce8bf7c7d09765a6bb96ac4f7abd952ba4591e47c8fed75b06cd39d0166f658dbbe2c90a67b5bf0b2c3beeff627113ccee6cff0571cd09c6a10b0000'
hex_data=hex_data.replace(":", "")

# alliance_name = "迷人又可爱的"
alliance_name = "可爱又迷人的"
# alliance_name = "玉子烧的小屋"
# alliance_name = "夜澀"
# alliance_name = "NOVOLAND"
# alliance_name = "one"

import gzip
from general import read_json, write_json

def decode_data(hex_data):
    """解碼二進制數據並提取成員信息。"""
    decompressed_data = gzip.decompress(bytes.fromhex(hex_data[10:]))
    # print(decompressed_data)
    result = decompressed_data.split(b'\x00')
    result = [item for item in result if item != b'']
    alliance_member = []
    for data in result:
        if len(data) > 1 and b'\x23' in data:
            try:
                utf8_data = data[:-1].decode('utf-8').split('#')
                server = int(utf8_data[0])
                member = f'#{server if server > 9 else f"0{server}"} {utf8_data[1]}'
                alliance_member.append(member)
            except (UnicodeDecodeError, ValueError) as e:
                print(e)
                pass
    return alliance_member

def update_alliance(alliance_name, new_members):
    """更新公會成員名單。"""
    alliance = read_json('alliance.json')
    old_members = alliance.get(alliance_name, [])
    leave = [m for m in old_members if m not in new_members]
    join = [m for m in new_members if m not in old_members]
    alliance[alliance_name] = new_members
    return alliance, join, leave

alliance_member = decode_data(hex_data)
while True:
    alliance, join, leave = update_alliance(alliance_name, alliance_member)
    print(f"加入的成員: {join}")
    print(f"離開的成員: {leave}")

    
    check = input('是否儲存(Y):').strip().upper()
    if check == 'Y':
        write_json('alliance.json', alliance)
        break
    elif check == 'N':
        continue